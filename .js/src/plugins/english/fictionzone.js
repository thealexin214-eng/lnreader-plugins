var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,s)}c((r=r.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},n=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,o=0,a=e.length;o<a;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),o=require("@libs/novelStatus"),a=function(){function a(){var t=this;this.id="fictionzone",this.name="Fiction Zone",this.icon="src/en/fictionzone/icon.png",this.site="https://fictionzone.net",this.version="1.0.2",this.filters=void 0,this.resolveUrl=function(e,n){return t.site+"/"+e.split("|")[0]}}return a.prototype.popularNovels=function(n,r){return t(this,arguments,void 0,(function(t,n){var r=n.showLatestNovels;n.filters;return e(this,(function(e){switch(e.label){case 0:return[4,this.getPage("/platform/browse?page=".concat(t,"&page_size=20&sort_by=").concat(r?"created_at":"bookmark_count","&sort_order=desc&include_genres=true"))];case 1:return[2,e.sent()]}}))}))},a.prototype.getData=function(n){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(this.site+"/api/__api_party/fictionzone",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:n,headers:[["content-type","application/json"],["x-request-time",(new Date).toISOString()]],method:"GET"})}).then((function(t){return t.json()}))];case 1:return[2,t.sent()]}}))}))},a.prototype.getPage=function(n){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,this.getData(n)];case 1:return[2,t.sent().data.novels.map((function(t){return{name:t.title,cover:"https://cdn.fictionzone.net/insecure/rs:fill:165:250/".concat(t.image,".webp"),path:"novel/".concat(t.slug)}}))]}}))}))},a.prototype.getChapterPage=function(n,r){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,this.getData("/platform/chapter-lists?novel_id="+n)];case 1:return[2,t.sent().data.chapters.map((function(t){return{name:t.title,number:t.chapter_number,date:t.published_date?new Date(t.published_date).toISOString():void 0,path:"".concat(r,"/").concat(t.chapter_id,"|/platform/chapter-content?novel_id=").concat(n,"&chapter_id=").concat(t.chapter_id)}}))]}}))}))},a.prototype.parseNovel=function(r){return t(this,void 0,void 0,(function(){var t,a,i,s;return e(this,(function(e){switch(e.label){case 0:return t=r.replace("novel/",""),[4,this.getData("/platform/novel-details?slug=".concat(t))];case 1:return a=e.sent(),i={path:r,name:a.data.title,cover:"https://cdn.fictionzone.net/insecure/rs:fill:165:250/".concat(a.data.image,".webp"),genres:n(n([],a.data.genres.map((function(t){return t.name})),!0),a.data.tags.map((function(t){return t.name})),!0).join(","),status:1==a.data.status?o.NovelStatus.Ongoing:0==a.data.status?o.NovelStatus.Completed:o.NovelStatus.Unknown,author:(null===(s=a.data.contributors.filter((function(t){return"author"==t.role}))[0])||void 0===s?void 0:s.display_name)||"",summary:a.data.synopsis},[4,this.getChapterPage(a.data.id,r)];case 2:return[2,(i.chapters=e.sent(),i)]}}))}))},a.prototype.parseChapter=function(n){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,this.getData(n.split("|")[1])];case 1:return[2,"<p>"+t.sent().data.content.replaceAll("\n","</p><p>")+"</p>"]}}))}))},a.prototype.searchNovels=function(n,r){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,this.getPage("/platform/browse?search=".concat(encodeURIComponent(n),"&page=").concat(r,"&page_size=20&search_in_synopsis=true&sort_by=bookmark_count&sort_order=desc&include_genres=true"))];case 1:return[2,t.sent()]}}))}))},a}();exports.default=new a;